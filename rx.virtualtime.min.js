(function(e){var t={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=t[typeof window]&&window||this,r=t[typeof exports]&&exports&&!exports.nodeType&&exports,i=t[typeof module]&&module&&!module.nodeType&&module,o=(i&&i.exports===r&&r,t[typeof global]&&global);!o||o.global!==o&&o.window!==o||(n=o),"function"==typeof define&&define.amd?define(["rx","exports"],function(t,r){return n.Rx=e(n,r,t),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=e(n,module.exports,require("./rx")):n.Rx=e(n,{},n.Rx)}).call(this,function(e,t,n){function r(e,t){return e-t}var i=n.Scheduler,o=n.Internals.PriorityQueue,s=n.Internals.ScheduledItem,u=n.Internals.SchedulePeriodicRecursive,c=n.Disposable.empty,a=n.Internals.inherits;return n.VirtualTimeScheduler=function(e){function t(){throw Error("Not implemented")}function n(){return this.toDateTimeOffset(this.clock)}function r(e,t){return this.scheduleAbsoluteWithState(e,this.clock,t)}function i(e,t,n){return this.scheduleRelativeWithState(e,this.toRelative(t),n)}function l(e,t,n){return this.scheduleRelativeWithState(e,this.toRelative(t-this.now()),n)}function h(e,t){return t(),c}function f(t,s){this.clock=t,this.comparer=s,this.isEnabled=!1,this.queue=new o(1024),e.call(this,n,r,i,l)}a(f,e);var p=f.prototype;return p.add=t,p.toDateTimeOffset=t,p.toRelative=t,p.schedulePeriodicWithState=function(e,t,n){var r=new u(this,e,t,n);return r.start()},p.scheduleRelativeWithState=function(e,t,n){var r=this.add(this.clock,t);return this.scheduleAbsoluteWithState(e,r,n)},p.scheduleRelative=function(e,t){return this.scheduleRelativeWithState(t,e,h)},p.start=function(){var e;if(!this.isEnabled){this.isEnabled=!0;do e=this.getNext(),null!==e?(this.comparer(e.dueTime,this.clock)>0&&(this.clock=e.dueTime),e.invoke()):this.isEnabled=!1;while(this.isEnabled)}},p.stop=function(){this.isEnabled=!1},p.advanceTo=function(e){var t,n=this.comparer(this.clock,e);if(this.comparer(this.clock,e)>0)throw Error(argumentOutOfRange);if(0!==n&&!this.isEnabled){this.isEnabled=!0;do t=this.getNext(),null!==t&&0>=this.comparer(t.dueTime,e)?(this.comparer(t.dueTime,this.clock)>0&&(this.clock=t.dueTime),t.invoke()):this.isEnabled=!1;while(this.isEnabled);this.clock=e}},p.advanceBy=function(e){var t=this.add(this.clock,e),n=this.comparer(this.clock,t);if(n>0)throw Error(argumentOutOfRange);0!==n&&this.advanceTo(t)},p.sleep=function(e){var t=this.add(this.clock,e);if(this.comparer(this.clock,t)>=0)throw Error(argumentOutOfRange);this.clock=t},p.getNext=function(){for(var e;this.queue.length>0;){if(e=this.queue.peek(),!e.isCancelled())return e;this.queue.dequeue()}return null},p.scheduleAbsolute=function(e,t){return this.scheduleAbsoluteWithState(t,e,h)},p.scheduleAbsoluteWithState=function(e,t,n){var r=this,i=function(e,t){return r.queue.remove(o),n(e,t)},o=new s(r,e,i,t,r.comparer);return r.queue.enqueue(o),o.disposable},f}(i),n.HistoricalScheduler=function(e){function t(t,n){var i=null==t?0:t,o=n||r;e.call(this,i,o)}a(t,e);var n=t.prototype;return n.add=function(e,t){return e+t},n.toDateTimeOffset=function(e){return new Date(e).getTime()},n.toRelative=function(e){return e},t}(n.VirtualTimeScheduler),n});