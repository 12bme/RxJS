(function(t,e){var n="object"==typeof exports&&exports,r=("object"==typeof module&&module&&module.exports==n&&module,"object"==typeof global&&global);r.global===r&&(window=r),"function"==typeof define&&define.amd?define(["rx","exports"],function(n,r){return t.Rx=e(t,r,n),t.Rx}):"object"==typeof module&&module&&module.exports===n?module.exports=e(t,module.exports,require("./rx")):t.Rx=e(t,{},t.Rx)})(this,function(t,e,n){function r(t,e){return t-e}var i=n.Scheduler,o=n.Internals.PriorityQueue,s=n.Internals.ScheduledItem,u=n.Internals.SchedulePeriodicRecursive,c=n.Disposable.empty,a=n.Internals.inherits;return n.VirtualTimeScheduler=function(t){function e(){return this.toDateTimeOffset(this.clock)}function n(t,e){return this.scheduleAbsoluteWithState(t,this.clock,e)}function r(t,e,n){return this.scheduleRelativeWithState(t,this.toRelative(e),n)}function i(t,e,n){return this.scheduleRelativeWithState(t,this.toRelative(e-this.now()),n)}function h(t,e){return e(),c}function l(s,u){this.clock=s,this.comparer=u,this.isEnabled=!1,this.queue=new o(1024),t.call(this,e,n,r,i)}a(l,t);var f=l.prototype;return f.schedulePeriodicWithState=function(t,e,n){var r=new u(this,t,e,n);return r.start()},f.scheduleRelativeWithState=function(t,e,n){var r=this.add(this.clock,e);return this.scheduleAbsoluteWithState(t,r,n)},f.scheduleRelative=function(t,e){return this.scheduleRelativeWithState(e,t,h)},f.start=function(){var t;if(!this.isEnabled){this.isEnabled=!0;do t=this.getNext(),null!==t?(this.comparer(t.dueTime,this.clock)>0&&(this.clock=t.dueTime),t.invoke()):this.isEnabled=!1;while(this.isEnabled)}},f.stop=function(){this.isEnabled=!1},f.advanceTo=function(t){var e,n=this.comparer(this.clock,t);if(this.comparer(this.clock,t)>0)throw Error(argumentOutOfRange);if(0!==n&&!this.isEnabled){this.isEnabled=!0;do e=this.getNext(),null!==e&&0>=this.comparer(e.dueTime,t)?(this.comparer(e.dueTime,this.clock)>0&&(this.clock=e.dueTime),e.invoke()):this.isEnabled=!1;while(this.isEnabled);this.clock=t}},f.advanceBy=function(t){var e=this.add(this.clock,t),n=this.comparer(this.clock,e);if(n>0)throw Error(argumentOutOfRange);return 0!==n?this.advanceTo(e):undefined},f.sleep=function(t){var e=this.add(this.clock,t);if(this.comparer(this.clock,e)>=0)throw Error(argumentOutOfRange);this.clock=e},f.getNext=function(){for(var t;this.queue.length>0;){if(t=this.queue.peek(),!t.isCancelled())return t;this.queue.dequeue()}return null},f.scheduleAbsolute=function(t,e){return this.scheduleAbsoluteWithState(e,t,h)},f.scheduleAbsoluteWithState=function(t,e,n){var r=this,i=function(t,e){return r.queue.remove(o),n(t,e)},o=new s(r,t,i,e,r.comparer);return r.queue.enqueue(o),o.disposable},l}(i),n.HistoricalScheduler=function(t){function e(e,n){var i=null==e?0:e,o=n||r;t.call(this,i,o)}a(e,t);var n=e.prototype;return n.add=function(t,e){return t+e},n.toDateTimeOffset=function(t){return new Date(t).getTime()},n.toRelative=function(t){return t},e}(n.VirtualTimeScheduler),n});