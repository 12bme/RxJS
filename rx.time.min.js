(function(e){var t={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=t[typeof window]&&window||this,r=t[typeof exports]&&exports&&!exports.nodeType&&exports,i=t[typeof module]&&module&&!module.nodeType&&module,o=(i&&i.exports===r&&r,t[typeof global]&&global);!o||o.global!==o&&o.window!==o||(n=o),"function"==typeof define&&define.amd?define(["rx","exports"],function(t,r){return n.Rx=e(n,r,t),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=e(n,module.exports,require("./rx")):n.Rx=e(n,{},n.Rx)}).call(this,function(e,t,n,r){function i(e,t){return new p(function(n){return t.scheduleWithAbsolute(e,function(){n.onNext(0),n.onCompleted()})})}function o(e,t,n){var r=A(t);return new p(function(t){var i=0,o=e;return n.scheduleRecursiveWithAbsolute(o,function(e){var s;r>0&&(s=n.now(),o+=r,s>=o&&(o=s+r)),t.onNext(i++),e(o)})})}function s(e,t){var n=A(e);return new p(function(e){return t.scheduleWithRelative(n,function(){e.onNext(0),e.onCompleted()})})}function u(e,t,n){return e===t?new p(function(e){return n.schedulePeriodicWithState(0,t,function(t){return e.onNext(t),t+1})}):d(function(){return o(n.now()+e,t,n)})}function c(e,t){var n=this;return new p(function(r){var i,o=!1,s=new x,u=null,c=[],a=!1;return i=n.materialize().timestamp(t).subscribe(function(n){var i,l;"E"===n.value.kind?(c=[],c.push(n),u=n.value.exception,l=!a):(c.push({value:n.value,timestamp:n.timestamp+e}),l=!o,o=!0),l&&(null!==u?r.onError(u):(i=new g,s.setDisposable(i),i.setDisposable(t.scheduleRecursiveWithRelative(e,function(e){var n,i,s,l;if(null===u){a=!0;do s=null,c.length>0&&0>=c[0].timestamp-t.now()&&(s=c.shift().value),null!==s&&s.accept(r);while(null!==s);l=!1,i=0,c.length>0?(l=!0,i=Math.max(0,c[0].timestamp-t.now())):o=!1,n=u,a=!1,null!==n?r.onError(n):l&&e(i)}}))))}),new E(i,s)})}function a(e,t){var n=this;return d(function(){var r=e-t.now();return c.call(n,r,t)})}function l(e,t){return new p(function(n){function r(){s&&(s=!1,n.onNext(o)),i&&n.onCompleted()}var i,o,s;return new E(e.subscribe(function(e){s=!0,o=e},n.onError.bind(n),function(){i=!0}),t.subscribe(r,n.onError.bind(n),r))})}var h=n.Observable,f=h.prototype,p=n.Internals.AnonymousObservable,d=h.defer,b=h.empty,v=h.never,m=h.throwException,y=h.fromArray,w=n.Scheduler.timeout,g=n.SingleAssignmentDisposable,x=n.SerialDisposable,E=n.CompositeDisposable,C=n.RefCountDisposable,D=n.Subject,N=(n.Internals.BinaryObserver,n.Internals.addRef),A=n.Scheduler.normalize,S=h.interval=function(e,t){return t||(t=w),u(e,e,t)},O=h.timer=function(e,t,n){var c;return n||(n=w),t!==r&&"number"==typeof t?c=t:t!==r&&"object"==typeof t&&(n=t),e instanceof Date&&c===r?i(e.getTime(),n):e instanceof Date&&c!==r?(c=t,o(e.getTime(),c,n)):c===r?s(e,n):u(e,c,n)};return f.delay=function(e,t){return t||(t=w),e instanceof Date?a.call(this,e.getTime(),t):c.call(this,e,t)},f.throttle=function(e,t){return t||(t=w),this.throttleWithSelector(function(){return O(e,t)})},f.windowWithTime=function(e,t,n){var i,o=this;return t===r&&(i=e),n===r&&(n=w),"number"==typeof t?i=t:"object"==typeof t&&(i=e,n=t),new p(function(t){function r(){var e=new g,o=!1,s=!1;h.setDisposable(e),a===c?(o=!0,s=!0):c>a?o=!0:s=!0;var p=o?a:c,d=p-f;f=p,o&&(a+=i),s&&(c+=i),e.setDisposable(n.scheduleWithRelative(d,function(){var e;s&&(e=new D,l.push(e),t.onNext(N(e,u))),o&&(e=l.shift(),e.onCompleted()),r()}))}var s,u,c=i,a=e,l=[],h=new x,f=0;return s=new E(h),u=new C(s),l.push(new D),t.onNext(N(l[0],u)),r(),s.add(o.subscribe(function(e){var t,n;for(t=0;l.length>t;t++)n=l[t],n.onNext(e)},function(e){var n,r;for(n=0;l.length>n;n++)r=l[n],r.onError(e);t.onError(e)},function(){var e,n;for(e=0;l.length>e;e++)n=l[e],n.onCompleted();t.onCompleted()})),u})},f.windowWithTimeOrCount=function(e,t,n){var r=this;return n||(n=w),new p(function(i){var o,s,u,c,a=0,l=new x,h=0;return s=new E(l),u=new C(s),o=function(t){var r=new g;l.setDisposable(r),r.setDisposable(n.scheduleWithRelative(e,function(){var e;t===h&&(a=0,e=++h,c.onCompleted(),c=new D,i.onNext(N(c,u)),o(e))}))},c=new D,i.onNext(N(c,u)),o(0),s.add(r.subscribe(function(e){var n=0,r=!1;c.onNext(e),a++,a===t&&(r=!0,a=0,n=++h,c.onCompleted(),c=new D,i.onNext(N(c,u))),r&&o(n)},function(e){c.onError(e),i.onError(e)},function(){c.onCompleted(),i.onCompleted()})),u})},f.bufferWithTime=function(){return this.windowWithTime.apply(this,arguments).selectMany(function(e){return e.toArray()})},f.bufferWithTimeOrCount=function(e,t,n){return this.windowWithTimeOrCount(e,t,n).selectMany(function(e){return e.toArray()})},f.timeInterval=function(e){var t=this;return e||(e=w),d(function(){var n=e.now();return t.select(function(t){var r=e.now(),i=r-n;return n=r,{value:t,interval:i}})})},f.timestamp=function(e){return e||(e=w),this.select(function(t){return{value:t,timestamp:e.now()}})},f.sample=function(e,t){return t||(t=w),"number"==typeof e?l(this,S(e,t)):l(this,e)},f.timeout=function(e,t,n){var r,i=this;return t||(t=m(Error("Timeout"))),n||(n=w),r=e instanceof Date?function(e,t){n.scheduleWithAbsolute(e,t)}:function(e,t){n.scheduleWithRelative(e,t)},new p(function(n){var o,s=0,u=new g,c=new x,a=!1,l=new x;return c.setDisposable(u),o=function(){var i=s;l.setDisposable(r(e,function(){a=s===i;var e=a;e&&c.setDisposable(t.subscribe(n))}))},o(),u.setDisposable(i.subscribe(function(e){var t=!a;t&&(s++,n.onNext(e),o())},function(e){var t=!a;t&&(s++,n.onError(e))},function(){var e=!a;e&&(s++,n.onCompleted())})),new E(c,l)})},h.generateWithAbsoluteTime=function(e,t,n,i,o,s){return s||(s=w),new p(function(u){var c,a,l=!0,h=!1,f=e;return s.scheduleRecursiveWithAbsolute(s.now(),function(e){h&&u.onNext(c);try{l?l=!1:f=n(f),h=t(f),h&&(c=i(f),a=o(f))}catch(s){return u.onError(s),r}h?e(a):u.onCompleted()})})},h.generateWithRelativeTime=function(e,t,n,i,o,s){return s||(s=w),new p(function(u){var c,a,l=!0,h=!1,f=e;return s.scheduleRecursiveWithRelative(0,function(e){h&&u.onNext(c);try{l?l=!1:f=n(f),h=t(f),h&&(c=i(f),a=o(f))}catch(s){return u.onError(s),r}h?e(a):u.onCompleted()})})},f.delaySubscription=function(e,t){return t||(t=w),this.delayWithSelector(O(e,t),function(){return b()})},f.delayWithSelector=function(e,t){var n,i,o=this;return"function"==typeof e?i=e:(n=e,i=t),new p(function(e){var t=new E,s=!1,u=function(){s&&0===t.length&&e.onCompleted()},c=new x,a=function(){c.setDisposable(o.subscribe(function(n){var o;try{o=i(n)}catch(s){return e.onError(s),r}var c=new g;t.add(c),c.setDisposable(o.subscribe(function(){e.onNext(n),t.remove(c),u()},e.onError.bind(e),function(){e.onNext(n),t.remove(c),u()}))},e.onError.bind(e),function(){s=!0,c.dispose(),u()}))};return n?c.setDisposable(n.subscribe(function(){a()},e.onError.bind(e),function(){a()})):a(),new E(c,t)})},f.timeoutWithSelector=function(e,t,n){if(1===arguments.length){t=e;var e=v()}n||(n=m(Error("Timeout")));var i=this;return new p(function(o){var s=new x,u=new x,c=new g;s.setDisposable(c);var a=0,l=!1,h=function(e){var t=a,r=function(){return a===t},i=new g;u.setDisposable(i),i.setDisposable(e.subscribe(function(){r()&&s.setDisposable(n.subscribe(o)),i.dispose()},function(e){r()&&o.onError(e)},function(){r()&&s.setDisposable(n.subscribe(o))}))};h(e);var f=function(){var e=!l;return e&&a++,e};return c.setDisposable(i.subscribe(function(e){if(f()){o.onNext(e);var n;try{n=t(e)}catch(i){return o.onError(i),r}h(n)}},function(e){f()&&o.onError(e)},function(){f()&&o.onCompleted()})),new E(s,u)})},f.throttleWithSelector=function(e){var t=this;return new p(function(n){var i,o=!1,s=new x,u=0,c=t.subscribe(function(t){var c;try{c=e(t)}catch(a){return n.onError(a),r}o=!0,i=t,u++;var l=u,h=new g;s.setDisposable(h),h.setDisposable(c.subscribe(function(){o&&u===l&&n.onNext(i),o=!1,h.dispose()},n.onError.bind(n),function(){o&&u===l&&n.onNext(i),o=!1,h.dispose()}))},function(e){s.dispose(),n.onError(e),o=!1,u++},function(){s.dispose(),o&&n.onNext(i),n.onCompleted(),o=!1,u++});return new E(c,s)})},f.skipLastWithTime=function(e,t){t||(t=w);var n=this;return new p(function(r){var i=[];return n.subscribe(function(n){var o=t.now();for(i.push({interval:o,value:n});i.length>0&&o-i[0].interval>=e;)r.onNext(i.shift().value)},r.onError.bind(r),function(){for(var n=t.now();i.length>0&&n-i[0].interval>=e;)r.onNext(i.shift().value);r.onCompleted()})})},f.takeLastWithTime=function(e,t,n){return this.takeLastBufferWithTime(e,t).selectMany(function(e){return y(e,n)})},f.takeLastBufferWithTime=function(e,t){var n=this;return t||(t=w),new p(function(r){var i=[];return n.subscribe(function(n){var r=t.now();for(i.push({interval:r,value:n});i.length>0&&r-i[0].interval>=e;)i.shift()},r.onError.bind(r),function(){for(var n=t.now(),o=[];i.length>0;){var s=i.shift();e>=n-s.interval&&o.push(s.value)}r.onNext(o),r.onCompleted()})})},f.takeWithTime=function(e,t){var n=this;return t||(t=w),new p(function(r){var i=t.scheduleWithRelative(e,function(){r.onCompleted()});return new E(i,n.subscribe(r))})},f.skipWithTime=function(e,t){var n=this;return t||(t=w),new p(function(r){var i=!1,o=t.scheduleWithRelative(e,function(){i=!0}),s=n.subscribe(function(e){i&&r.onNext(e)},r.onError.bind(r),r.onCompleted.bind(r));return new E(o,s)})},f.skipUntilWithTime=function(e,t){t||(t=w);var n=this;return new p(function(r){var i=!1,o=t.scheduleWithAbsolute(e,function(){i=!0}),s=n.subscribe(function(e){i&&r.onNext(e)},r.onError.bind(r),r.onCompleted.bind(r));return new E(o,s)})},f.takeUntilWithTime=function(e,t){t||(t=w);var n=this;return new p(function(r){return new E(t.scheduleWithAbsolute(e,function(){r.onCompleted()}),n.subscribe(r))})},n});