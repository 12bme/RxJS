(function(t){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=e[typeof window]&&window||this,r=e[typeof exports]&&exports&&!exports.nodeType&&exports,i=e[typeof module]&&module&&!module.nodeType&&module,o=(i&&i.exports===r&&r,e[typeof global]&&global);!o||o.global!==o&&o.window!==o||(n=o),"function"==typeof define&&define.amd?define(["rx","exports"],function(e,r){return n.Rx=t(n,r,e),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=t(n,module.exports,require("./rx")):n.Rx=t(n,{},n.Rx)}).call(this,function(t,e,n){function r(){if(this.isDisposed)throw Error(d)}var i=n.Observable,o=i.prototype,s=n.Internals.AnonymousObservable,u=n.Subject,c=n.Observer,a=n.Disposable.empty,h=n.Disposable.create,l=n.Internals.inherits,f=n.Internals.addProperties,p=n.Scheduler.timeout,d="Object has been disposed";o.pausable=function(t){var e=this;return new s(function(n){var r=e.publish(),i=r.subscribe(n),o=a,s=t.distinctUntilChanged().subscribe(function(t){t?o=r.connect():(o.dispose(),o=a)});return new CompositeDisposable(i,o,s)})},o.controlled=function(t){return null==t&&(t=!0),new b(this,t)};var b=function(t){function e(t){return this.source.subscribe(t)}function n(n,r){t.call(this,e),this.subject=new v(r),this.source=n.multicast(this.subject).refCount()}return l(n,t),n.prototype.request=function(t){return null==t&&(t=-1),this.subject.request(t)},n}(i),v=n.ControlledSubject=function(t){function e(t){return this.subject.subscribe(t)}function n(n){null==n&&(n=!0),t.call(this,e),this.subject=new u,this.enableQueue=n,this.queue=n?[]:null,this.requestedCount=0,this.requestedDisposable=a,this.error=null,this.hasFailed=!1,this.hasCompleted=!1,this.controlledDisposable=a}return l(n,t),f(n.prototype,c,{onCompleted:function(){r.call(this),this.hasCompleted=!0,this.enableQueue&&0!==this.queue.length||this.onCompleted()},onError:function(t){r.call(this),this.hasFailed=!0,this.error=t,this.enableQueue&&0!==this.queue.length||this.onError(t)},onNext:function(t){r.call(this);var e=!1;0===this.requestedCount?this.queue&&this.queue.push(t):(-1!==this.requestedCount&&0===this.requestedCount--&&this.disposeCurrentRequest(),e=!0),e&&this.subject.onNext(t)},_processRequest:function(t){if(this.disposeCurrentRequest(),this.enableQueue){for(console.log("queue length",this.queue.length);this.queue.length>=t&&t>0;)console.log("number of items",t),this.subject.onNext(this.queue.shift()),t--;return 0!==this.queue.length?{numberOfItems:t,returnValue:!0}:{numberOfItems:t,returnValue:!1}}return this.hasFailed?(this.subject.onError(this.error),this.controlledDisposable.dispose(),this.controlledDisposable=a):this.hasCompleted&&(this.subject.onCompleted(),this.controlledDisposable.dispose(),this.controlledDisposable=a),{numberOfItems:t,returnValue:!1}},request:function(t){r.call(this),this.disposeCurrentRequest();var e=this,n=this._processRequest(t);return t=n.numberOfItems,n.returnValue?(this.requestedCount=t,this.requestedDisposable=h(function(){e.requestedCount=0}),this.requestedDisposable):a},disposeCurrentRequest:function(){this.requestedDisposable.dispose(),this.requestedDisposable=a},dispose:function(){this.isDisposed=!0,this.error=null,this.subject.dispose(),this.requestedDisposable.dispose()}}),n}(i);b.prototype.windowed=function(t,e){return new m(this,t,e||p)};var m=function(t){function e(t){this.subscription=this.source.subscribe(new i(t,this,this.subscription,this.scheduler));var e=this;return e.scheduler.schedule(function(){e.source.request(e.windowSize)}),this.subscription}function n(n,r,i){t.call(this,e),this.source=n,this.windowSize=r,this.scheduler=i,this.isDisposed=!1}l(n,t);var i=function(t){function e(t,e,n,r){this.observer=t,this.observable=e,this.cancel=n,this.scheduler=r,this.received=0,this.isDisposed=!1}l(e,t);var n=e.prototype;return n.onCompleted=function(){r.call(this),this.observer.onCompleted(),this.dispose()},n.onError=function(t){r.call(this),this.observer.onError(t),this.dispose()},n.onNext=function(t){if(r.call(this),this.observer.onNext(t),this.received=++this.received%this.observable.windowSize,0===this.received){var e=this;e.scheduler.schedule(function(){e.observable.source.request(e.observable.windowSize)})}},n.dispose=function(){this.observer=null,this.cancel&&(this.cancel.dispose(),this.cancel=null),this.isDisposed=!0},e}(c);return n}(i);return n});