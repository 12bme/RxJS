/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx"],function(b,d){return a(c,d,b)}):"object"==typeof module&&module&&module.exports===d?module.exports=a(c,module.exports,require("./rx")):c.Rx=a(c,{},c.Rx)}).call(this,function(a,b,c,d){function e(a,b){return 1===a.length&&Array.isArray(a[b])?a[b]:J.call(a)}function f(a,b){this.scheduler=a,this.disposable=b,this.isDisposed=!1}function g(a,b){b.isDisposed||(b.isDisposed=!0,b.disposable.dispose())}function h(a,b,c){for(var d=0,e=a.length;e>d;d++)if(c(a[d],b))return d;return-1}function i(a){this.comparer=a,this.set=[]}var j=c.Observable,k=j.prototype,l=j.never,m=j.throwException,n=c.AnonymousObservable,o=c.AnonymousObserver,p=c.Notification.createOnNext,q=c.Notification.createOnError,r=c.Notification.createOnCompleted,s=c.Observer,t=c.Subject,u=c.internals,v=c.helpers,w=u.ScheduledObserver,x=c.SerialDisposable,y=c.SingleAssignmentDisposable,z=c.CompositeDisposable,A=c.RefCountDisposable,B=c.Disposable.empty,C=c.Scheduler.immediate,D=(v.defaultKeySerializer,c.internals.addRef),E=(v.identity,v.isPromise),F=u.inherits,G=u.bindCallback,H=(v.noop,v.isScheduler),I=j.fromPromise,J=Array.prototype.slice,K="Argument out of range";f.prototype.dispose=function(){this.scheduler.scheduleWithState(this,g)};var L=function(a){function b(b){a.call(this),this._observer=b,this._state=0}F(b,a);var c=b.prototype;return c.onNext=function(a){this.checkAccess();try{this._observer.onNext(a)}catch(b){throw b}finally{this._state=0}},c.onError=function(a){this.checkAccess();try{this._observer.onError(a)}catch(b){throw b}finally{this._state=2}},c.onCompleted=function(){this.checkAccess();try{this._observer.onCompleted()}catch(a){throw a}finally{this._state=2}},c.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},b}(s),M=function(a){function b(b,c,d){a.call(this,b,c),this._cancel=d}return F(b,a),b.prototype.next=function(b){a.prototype.next.call(this,b),this.ensureActive()},b.prototype.error=function(b){a.prototype.error.call(this,b),this.ensureActive()},b.prototype.completed=function(){a.prototype.completed.call(this),this.ensureActive()},b.prototype.dispose=function(){a.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},b}(w);s.prototype.checked=function(){return new L(this)},s.notifyOn=function(a){return new M(a,this)},s.fromNotifier=function(a,b){var c=G(a,b,1);return new o(function(a){return c(p(a))},function(a){return c(q(a))},function(){return c(r())})},s.prototype.toNotifier=function(){var a=this;return function(b){return b.accept(a)}},s.prototype.asObserver=function(){var a=this;return new o(function(b){a.onNext(b)},function(b){a.onError(b)},function(){a.onCompleted()})},k.observeOn=function(a){var b=this;return new n(function(c){return b.subscribe(new M(a,c))},b)},k.subscribeOn=function(a){var b=this;return new n(function(c){var d=new y,e=new x;return e.setDisposable(d),d.setDisposable(a.schedule(function(){e.setDisposable(new f(a,b.subscribe(c)))})),e},b)},j.generate=function(a,b,c,d,e){return H(e)||(e=currentThreadScheduler),new n(function(f){var g=!0,h=a;return e.scheduleRecursive(function(a){var e,i;try{g?g=!1:h=c(h),e=b(h),e&&(i=d(h))}catch(j){return void f.onError(j)}e?(f.onNext(i),a()):f.onCompleted()})})},j.using=function(a,b){return new n(function(c){var d,e,f=B;try{d=a(),d&&(f=d),e=b(d)}catch(g){return new z(m(g).subscribe(c),f)}return new z(e.subscribe(c),f)})},k.amb=function(a){var b=this;return new n(function(c){function d(){f||(f=g,j.dispose())}function e(){f||(f=h,i.dispose())}var f,g="L",h="R",i=new y,j=new y;return E(a)&&(a=I(a)),i.setDisposable(b.subscribe(function(a){d(),f===g&&c.onNext(a)},function(a){d(),f===g&&c.onError(a)},function(){d(),f===g&&c.onCompleted()})),j.setDisposable(a.subscribe(function(a){e(),f===h&&c.onNext(a)},function(a){e(),f===h&&c.onError(a)},function(){e(),f===h&&c.onCompleted()})),new z(i,j)})},j.amb=function(){function a(a,b){return a.amb(b)}for(var b=l(),c=e(arguments,0),d=0,f=c.length;f>d;d++)b=a(b,c[d]);return b},k.onErrorResumeNext=function(a){if(!a)throw new Error("Second observable is required");return N([this,a])};var N=j.onErrorResumeNext=function(){var a=e(arguments,0);return new n(function(b){var c=0,d=new x,e=C.scheduleRecursive(function(e){var f,g;c<a.length?(f=a[c++],E(f)&&(f=I(f)),g=new y,d.setDisposable(g),g.setDisposable(f.subscribe(b.onNext.bind(b),e,e))):b.onCompleted()});return new z(d,e)})};return k.bufferWithCount=function(a,b){return"number"!=typeof b&&(b=a),this.windowWithCount(a,b).selectMany(function(a){return a.toArray()}).where(function(a){return a.length>0})},k.windowWithCount=function(a,b){var c=this;if(+a||(a=0),1/0===Math.abs(a)&&(a=0),0>=a)throw new Error(K);if(null==b&&(b=a),+b||(b=0),1/0===Math.abs(b)&&(b=0),0>=b)throw new Error(K);return new n(function(d){function e(){var a=new t;i.push(a),d.onNext(D(a,g))}var f=new y,g=new A(f),h=0,i=[];return e(),f.setDisposable(c.subscribe(function(c){for(var d=0,f=i.length;f>d;d++)i[d].onNext(c);var g=h-a+1;g>=0&&g%b===0&&i.shift().onCompleted(),++h%b===0&&e()},function(a){for(;i.length>0;)i.shift().onError(a);d.onError(a)},function(){for(;i.length>0;)i.shift().onCompleted();d.onCompleted()})),g},c)},k.takeLastBuffer=function(a){var b=this;return new n(function(c){var d=[];return b.subscribe(function(b){d.push(b),d.length>a&&d.shift()},function(a){c.onError(a)},function(){c.onNext(d),c.onCompleted()})},b)},k.defaultIfEmpty=function(a){var b=this;return a===d&&(a=null),new n(function(c){var d=!1;return b.subscribe(function(a){d=!0,c.onNext(a)},function(a){c.onError(a)},function(){!d&&c.onNext(a),c.onCompleted()})},b)},i.prototype.push=function(a){var b=-1===h(this.set,a,this.comparer);return b&&this.set.push(a),b},k.distinct=function(a,b){var c=this;return b||(b=defaultComparer),new n(function(d){var e=new i(b);return c.subscribe(function(b){var c=b;if(a)try{c=a(b)}catch(f){return void d.onError(f)}e.push(c)&&d.onNext(b)},function(a){d.onError(a)},function(){d.onCompleted()})},this)},c});
//# sourceMappingURL=rx.lite.extras.map