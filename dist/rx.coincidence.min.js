(function(t){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=e[typeof window]&&window||this,r=e[typeof exports]&&exports&&!exports.nodeType&&exports,o=e[typeof module]&&module&&!module.nodeType&&module,i=(o&&o.exports===r&&r,e[typeof global]&&global);!i||i.global!==i&&i.window!==i||(n=i),"function"==typeof define&&define.amd?define(["rx","exports"],function(e,r){return n.Rx=t(n,r,e),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=t(n,module.exports,require("./rx")):n.Rx=t(n,{},n.Rx)}).call(this,function(t,e,n,r){function o(t,e){return t.groupJoin(this,e,function(){return d()},function(t,e){return e})}function i(t){var e=this;return new b(function(n){var r=new f,o=new c,i=new a(o);return n.onNext(m(r,i)),o.add(e.subscribe(function(t){r.onNext(t)},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),o.add(t.subscribe(function(){r.onCompleted(),r=new f,n.onNext(m(r,i))},function(t){r.onError(t),n.onError(t)},function(){r.onCompleted(),n.onCompleted()})),i})}function s(t){var e=this;return new b(function(n){var o,i=new l,s=new c(i),u=new a(s),p=new f;return n.onNext(m(p,u)),s.add(e.subscribe(function(t){p.onNext(t)},function(t){p.onError(t),n.onError(t)},function(){p.onCompleted(),n.onCompleted()})),o=function(){var e,s;try{s=t()}catch(c){return n.onError(c),r}e=new h,i.setDisposable(e),e.setDisposable(s.take(1).subscribe(w,function(t){p.onError(t),n.onError(t)},function(){p.onCompleted(),p=new f,n.onNext(m(p,u)),o()}))},o(),u})}var u=n.Observable,c=n.CompositeDisposable,a=n.RefCountDisposable,h=n.SingleAssignmentDisposable,l=n.SerialDisposable,f=n.Subject,p=u.prototype,d=u.empty,v=u.never,b=n.AnonymousObservable,m=(n.Observer.create,n.internals.addRef),y=n.internals.isEqual,w=n.helpers.noop,g=n.helpers.identity,E=function(){function t(t){if(false&t)return 2===t;for(var e=Math.sqrt(t),n=3;e>=n;){if(0===t%n)return!1;n+=2}return!0}function e(e){var n,r,o;for(n=0;u.length>n;++n)if(r=u[n],r>=e)return r;for(o=1|e;u[u.length-1]>o;){if(t(o))return o;o+=2}return e}function n(t){var e=757602046;if(!t.length)return e;for(var n=0,r=t.length;r>n;n++){var o=t.charCodeAt(n);e=(e<<5)-e+o,e&=e}return e}function o(t){var e=668265261;return t=61^t^t>>>16,t+=t<<3,t^=t>>>4,t*=e,t^=t>>>15}function i(){return{key:null,value:null,next:0,hashCode:0}}function s(t,e){if(0>t)throw Error("out of range");t>0&&this._initialize(t),this.comparer=e||y,this.freeCount=0,this.size=0,this.freeList=-1}var u=[1,3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143,4194301,8388593,16777213,33554393,67108859,134217689,268435399,536870909,1073741789,2147483647],c="no such key",a="duplicate key",h=function(){var t=0;return function(e){if(null==e)throw Error(c);if("string"==typeof e)return n(e);if("number"==typeof e)return o(e);if("boolean"==typeof e)return e===!0?1:0;if(e instanceof Date)return o(e.valueOf());if(e instanceof RegExp)return n(""+e);if("function"==typeof e.valueOf){var r=e.valueOf();if("number"==typeof r)return o(r);if("string"==typeof e)return n(r)}if(e.getHashCode)return e.getHashCode();var i=17*t++;return e.getHashCode=function(){return i},i}}(),l=s.prototype;return l._initialize=function(t){var n,r=e(t);for(this.buckets=Array(r),this.entries=Array(r),n=0;r>n;n++)this.buckets[n]=-1,this.entries[n]=i();this.freeList=-1},l.add=function(t,e){return this._insert(t,e,!0)},l._insert=function(t,e,n){this.buckets||this._initialize(0);for(var o,i=2147483647&h(t),s=i%this.buckets.length,u=this.buckets[s];u>=0;u=this.entries[u].next)if(this.entries[u].hashCode===i&&this.comparer(this.entries[u].key,t)){if(n)throw Error(a);return this.entries[u].value=e,r}this.freeCount>0?(o=this.freeList,this.freeList=this.entries[o].next,--this.freeCount):(this.size===this.entries.length&&(this._resize(),s=i%this.buckets.length),o=this.size,++this.size),this.entries[o].hashCode=i,this.entries[o].next=this.buckets[s],this.entries[o].key=t,this.entries[o].value=e,this.buckets[s]=o},l._resize=function(){var t=e(2*this.size),n=Array(t);for(o=0;n.length>o;++o)n[o]=-1;var r=Array(t);for(o=0;this.size>o;++o)r[o]=this.entries[o];for(var o=this.size;t>o;++o)r[o]=i();for(var s=0;this.size>s;++s){var u=r[s].hashCode%t;r[s].next=n[u],n[u]=s}this.buckets=n,this.entries=r},l.remove=function(t){if(this.buckets)for(var e=2147483647&h(t),n=e%this.buckets.length,r=-1,o=this.buckets[n];o>=0;o=this.entries[o].next){if(this.entries[o].hashCode===e&&this.comparer(this.entries[o].key,t))return 0>r?this.buckets[n]=this.entries[o].next:this.entries[r].next=this.entries[o].next,this.entries[o].hashCode=-1,this.entries[o].next=this.freeList,this.entries[o].key=null,this.entries[o].value=null,this.freeList=o,++this.freeCount,!0;r=o}return!1},l.clear=function(){var t,e;if(!(0>=this.size)){for(t=0,e=this.buckets.length;e>t;++t)this.buckets[t]=-1;for(t=0;this.size>t;++t)this.entries[t]=i();this.freeList=-1,this.size=0}},l._findEntry=function(t){if(this.buckets)for(var e=2147483647&h(t),n=this.buckets[e%this.buckets.length];n>=0;n=this.entries[n].next)if(this.entries[n].hashCode===e&&this.comparer(this.entries[n].key,t))return n;return-1},l.count=function(){return this.size-this.freeCount},l.tryGetValue=function(t){var e=this._findEntry(t);return e>=0?this.entries[e].value:r},l.getValues=function(){var t=0,e=[];if(this.entries)for(var n=0;this.size>n;n++)this.entries[n].hashCode>=0&&(e[t++]=this.entries[n].value);return e},l.get=function(t){var e=this._findEntry(t);if(e>=0)return this.entries[e].value;throw Error(c)},l.set=function(t,e){this._insert(t,e,!1)},l.containskey=function(t){return this._findEntry(t)>=0},s}();p.join=function(t,e,n,o){var i=this;return new b(function(s){var u=new c,a=!1,l=!1,f=0,p=0,d=new E,v=new E;return u.add(i.subscribe(function(t){var n=f++,i=new h;d.add(n,t),u.add(i);var c,l=function(){d.remove(n)&&0===d.count()&&a&&s.onCompleted(),u.remove(i)};try{c=e(t)}catch(p){return s.onError(p),r}i.setDisposable(c.take(1).subscribe(w,s.onError.bind(s),l)),v.getValues().forEach(function(e){var n;try{n=o(t,e)}catch(i){return s.onError(i),r}s.onNext(n)})},s.onError.bind(s),function(){a=!0,(l||0===d.count())&&s.onCompleted()})),u.add(t.subscribe(function(t){var e=p++,i=new h;v.add(e,t),u.add(i);var c,a=function(){v.remove(e)&&0===v.count()&&l&&s.onCompleted(),u.remove(i)};try{c=n(t)}catch(f){return s.onError(f),r}i.setDisposable(c.take(1).subscribe(w,s.onError.bind(s),a)),d.getValues().forEach(function(e){var n;try{n=o(e,t)}catch(i){return s.onError(i),r}s.onNext(n)})},s.onError.bind(s),function(){l=!0,(a||0===v.count())&&s.onCompleted()})),u})},p.groupJoin=function(t,e,n,o){var i=this;return new b(function(s){function u(t){return function(e){e.onError(t)}}var l=new c,p=new a(l),d=new E,v=new E,b=0,y=0;return l.add(i.subscribe(function(t){var n=new f,i=b++;d.add(i,n);var c;try{c=o(t,m(n,p))}catch(a){return d.getValues().forEach(u(a)),s.onError(a),r}s.onNext(c),v.getValues().forEach(function(t){n.onNext(t)});var y=new h;l.add(y);var g,E=function(){d.remove(i)&&n.onCompleted(),l.remove(y)};try{g=e(t)}catch(a){return d.getValues().forEach(u(a)),s.onError(a),r}y.setDisposable(g.take(1).subscribe(w,function(t){d.getValues().forEach(u(t)),s.onError(t)},E))},function(t){d.getValues().forEach(u(t)),s.onError(t)},s.onCompleted.bind(s))),l.add(t.subscribe(function(t){var e=y++;v.add(e,t);var o=new h;l.add(o);var i,c=function(){v.remove(e),l.remove(o)};try{i=n(t)}catch(a){return d.getValues().forEach(u(a)),s.onError(a),r}o.setDisposable(i.take(1).subscribe(w,function(t){d.getValues().forEach(u(t)),s.onError(t)},c)),d.getValues().forEach(function(e){e.onNext(t)})},function(t){d.getValues().forEach(u(t)),s.onError(t)})),p})},p.buffer=function(){return this.window.apply(this,arguments).selectMany(function(t){return t.toArray()})},p.window=function(t,e){return 1===arguments.length&&"function"!=typeof arguments[0]?i.call(this,t):"function"==typeof t?s.call(this,t):o.call(this,t,e)},p.pairwise=function(){var t=this;return new b(function(e){var n,r=!1;return t.subscribe(function(t){r?e.onNext([n,t]):r=!0,n=t},e.onError.bind(e),e.onCompleted.bind(e))})},p.partition=function(t,e){var n=this.publish().refCount();return[n.filter(t,e),n.filter(function(n,r,o){return!t.call(e,n,r,o)})]},p.groupBy=function(t,e,n){return this.groupByUntil(t,e,v,n)},p.groupByUntil=function(t,e,n,o){var i=this;return e||(e=g),o||(o=y),new b(function(s){function u(t){return function(e){e.onError(t)}}var l=new E(0,o),p=new c,d=new a(p);return p.add(i.subscribe(function(o){var i;try{i=t(o)}catch(c){return l.getValues().forEach(u(c)),s.onError(c),r}var a=!1,v=l.tryGetValue(i);if(v||(v=new f,l.set(i,v),a=!0),a){var b=new x(i,v,d),m=new x(i,v);try{duration=n(m)}catch(c){return l.getValues().forEach(u(c)),s.onError(c),r}s.onNext(b);var y=new h;p.add(y);var g=function(){l.remove(i)&&v.onCompleted(),p.remove(y)};y.setDisposable(duration.take(1).subscribe(w,function(t){l.getValues().forEach(u(t)),s.onError(t)},g))}var E;try{E=e(o)}catch(c){return l.getValues().forEach(u(c)),s.onError(c),r}v.onNext(E)},function(t){l.getValues().forEach(u(t)),s.onError(t)},function(){l.getValues().forEach(function(t){t.onCompleted()}),s.onCompleted()})),d})};var x=function(t){function e(t){return this.underlyingObservable.subscribe(t)}function n(n,r,o){t.call(this,e),this.key=n,this.underlyingObservable=o?new b(function(t){return new c(o.getDisposable(),r.subscribe(t))}):r}return inherits(n,t),n}(u);return n});