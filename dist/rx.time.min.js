(function(t){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},n=e[typeof window]&&window||this,r=e[typeof exports]&&exports&&!exports.nodeType&&exports,o=e[typeof module]&&module&&!module.nodeType&&module,i=(o&&o.exports===r&&r,e[typeof global]&&global);!i||i.global!==i&&i.window!==i||(n=i),"function"==typeof define&&define.amd?define(["rx","exports"],function(e,r){return n.Rx=t(n,r,e),n.Rx}):"object"==typeof module&&module&&module.exports===r?module.exports=t(n,module.exports,require("./rx")):n.Rx=t(n,{},n.Rx)}).call(this,function(t,e,n,r){function o(t,e){return new p(function(n){return e.scheduleWithAbsolute(t,function(){n.onNext(0),n.onCompleted()})})}function i(t,e,n){return new p(function(r){var o=0,i=t,s=D(e);return n.scheduleRecursiveWithAbsolute(i,function(t){if(s>0){var e=n.now();i+=s,e>=i&&(i=e+s)}r.onNext(o++),t(i)})})}function s(t,e){return new p(function(n){return e.scheduleWithRelative(D(t),function(){n.onNext(0),n.onCompleted()})})}function u(t,e,n){return t===e?new p(function(t){return n.schedulePeriodicWithState(0,e,function(e){return t.onNext(e),e+1})}):d(function(){return i(n.now()+t,e,n)})}function c(t,e,n){return new p(function(r){var o,i=!1,s=new g,u=null,c=[],a=!1;return o=t.materialize().timestamp(n).subscribe(function(t){var o,l;"E"===t.value.kind?(c=[],c.push(t),u=t.value.exception,l=!a):(c.push({value:t.value,timestamp:t.timestamp+e}),l=!i,i=!0),l&&(null!==u?r.onError(u):(o=new w,s.setDisposable(o),o.setDisposable(n.scheduleRecursiveWithRelative(e,function(t){var e,o,s,l;if(null===u){a=!0;do s=null,c.length>0&&0>=c[0].timestamp-n.now()&&(s=c.shift().value),null!==s&&s.accept(r);while(null!==s);l=!1,o=0,c.length>0?(l=!0,o=Math.max(0,c[0].timestamp-n.now())):i=!1,e=u,a=!1,null!==e?r.onError(e):l&&t(o)}}))))}),new E(o,s)})}function a(t,e,n){return d(function(){return c(t,e-n.now(),n)})}function l(t,e){return new p(function(n){function r(){s&&(s=!1,n.onNext(i)),o&&n.onCompleted()}var o,i,s;return new E(t.subscribe(function(t){s=!0,i=t},n.onError.bind(n),function(){o=!0}),e.subscribe(r,n.onError.bind(n),r))})}var f=n.Observable,h=f.prototype,p=n.AnonymousObservable,d=f.defer,b=f.empty,v=f.never,m=f.throwException,y=(f.fromArray,n.Scheduler.timeout),w=n.SingleAssignmentDisposable,g=n.SerialDisposable,E=n.CompositeDisposable,x=n.RefCountDisposable,C=n.Subject,N=n.internals.addRef,D=n.Scheduler.normalize,A=n.helpers,S=A.isPromise,O=A.isScheduler,_=f.fromPromise;A.notDefined;var R=f.interval=function(t,e){return u(t,t,O(e)?e:y)},k=f.timer=function(t,e,n){var c;return O(n)||(n=y),e!==r&&"number"==typeof e?c=e:O(e)&&(n=e),t instanceof Date&&c===r?o(t.getTime(),n):t instanceof Date&&c!==r?(c=e,i(t.getTime(),c,n)):c===r?s(t,n):u(t,c,n)};return h.delay=function(t,e){return O(e)||(e=y),t instanceof Date?a(this,t.getTime(),e):c(this,t,e)},h.throttle=function(t,e){O(e)||(e=y);var n=this;return new p(function(r){var o,i=new g,s=!1,u=0,c=n.subscribe(function(n){s=!0,o=n,u++;var c=u,a=new w;i.setDisposable(a),a.setDisposable(e.scheduleWithRelative(t,function(){s&&u===c&&r.onNext(o),s=!1}))},function(t){i.dispose(),r.onError(t),s=!1,u++},function(){i.dispose(),s&&r.onNext(o),r.onCompleted(),s=!1,u++});return new E(c,i)})},h.windowWithTime=function(t,e,n){var o,i=this;return e===r&&(o=t),O(n)||(n=y),"number"==typeof e?o=e:O(e)&&(o=t,n=e),new p(function(e){function r(){var t=new w,i=!1,s=!1;f.setDisposable(t),a===c?(i=!0,s=!0):c>a?i=!0:s=!0;var p=i?a:c,d=p-h;h=p,i&&(a+=o),s&&(c+=o),t.setDisposable(n.scheduleWithRelative(d,function(){var t;s&&(t=new C,l.push(t),e.onNext(N(t,u))),i&&(t=l.shift(),t.onCompleted()),r()}))}var s,u,c=o,a=t,l=[],f=new g,h=0;return s=new E(f),u=new x(s),l.push(new C),e.onNext(N(l[0],u)),r(),s.add(i.subscribe(function(t){for(var e=0,n=l.length;n>e;e++)l[e].onNext(t)},function(t){for(var n=0,r=l.length;r>n;n++)l[n].onError(t);e.onError(t)},function(){for(var t=0,n=l.length;n>t;t++)l[t].onCompleted();e.onCompleted()})),u})},h.windowWithTimeOrCount=function(t,e,n){var r=this;return O(n)||(n=y),new p(function(o){var i,s,u,c,a=0,l=new g,f=0;return s=new E(l),u=new x(s),i=function(e){var r=new w;l.setDisposable(r),r.setDisposable(n.scheduleWithRelative(t,function(){var t;e===f&&(a=0,t=++f,c.onCompleted(),c=new C,o.onNext(N(c,u)),i(t))}))},c=new C,o.onNext(N(c,u)),i(0),s.add(r.subscribe(function(t){var n=0,r=!1;c.onNext(t),a++,a===e&&(r=!0,a=0,n=++f,c.onCompleted(),c=new C,o.onNext(N(c,u))),r&&i(n)},function(t){c.onError(t),o.onError(t)},function(){c.onCompleted(),o.onCompleted()})),u})},h.bufferWithTime=function(){return this.windowWithTime.apply(this,arguments).selectMany(function(t){return t.toArray()})},h.bufferWithTimeOrCount=function(t,e,n){return this.windowWithTimeOrCount(t,e,n).selectMany(function(t){return t.toArray()})},h.timeInterval=function(t){var e=this;return O(t)||(t=y),d(function(){var n=t.now();return e.map(function(e){var r=t.now(),o=r-n;return n=r,{value:e,interval:o}})})},h.timestamp=function(t){return O(t)||(t=y),this.map(function(e){return{value:e,timestamp:t.now()}})},h.sample=function(t,e){return O(e)||(e=y),"number"==typeof t?l(this,R(t,e)):l(this,t)},h.timeout=function(t,e,n){e||(e=m(Error("Timeout"))),O(n)||(n=y);var r=this,o=t instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new p(function(i){function s(){var r=u;f.setDisposable(n[o](t,function(){u===r&&(S(e)&&(e=_(e)),a.setDisposable(e.subscribe(i)))}))}var u=0,c=new w,a=new g,l=!1,f=new g;return a.setDisposable(c),s(),c.setDisposable(r.subscribe(function(t){l||(u++,i.onNext(t),s())},function(t){l||(u++,i.onError(t))},function(){l||(u++,i.onCompleted())})),new E(a,f)})},f.generateWithAbsoluteTime=function(t,e,n,o,i,s){return O(s)||(s=y),new p(function(u){var c,a,l=!0,f=!1,h=t;return s.scheduleRecursiveWithAbsolute(s.now(),function(t){f&&u.onNext(c);try{l?l=!1:h=n(h),f=e(h),f&&(c=o(h),a=i(h))}catch(s){return u.onError(s),r}f?t(a):u.onCompleted()})})},f.generateWithRelativeTime=function(t,e,n,o,i,s){return O(s)||(s=y),new p(function(u){var c,a,l=!0,f=!1,h=t;return s.scheduleRecursiveWithRelative(0,function(t){f&&u.onNext(c);try{l?l=!1:h=n(h),f=e(h),f&&(c=o(h),a=i(h))}catch(s){return u.onError(s),r}f?t(a):u.onCompleted()})})},h.delaySubscription=function(t,e){return this.delayWithSelector(k(t,O(e)?e:y),b)},h.delayWithSelector=function(t,e){var n,o,i=this;return"function"==typeof t?o=t:(n=t,o=e),new p(function(t){var e=new E,s=!1,u=function(){s&&0===e.length&&t.onCompleted()},c=new g,a=function(){c.setDisposable(i.subscribe(function(n){var i;try{i=o(n)}catch(s){return t.onError(s),r}var c=new w;e.add(c),c.setDisposable(i.subscribe(function(){t.onNext(n),e.remove(c),u()},t.onError.bind(t),function(){t.onNext(n),e.remove(c),u()}))},t.onError.bind(t),function(){s=!0,c.dispose(),u()}))};return n?c.setDisposable(n.subscribe(function(){a()},t.onError.bind(t),function(){a()})):a(),new E(c,e)})},h.timeoutWithSelector=function(t,e,n){1===arguments.length&&(e=t,t=v()),n||(n=m(Error("Timeout")));var o=this;return new p(function(i){function s(t){function e(){return f===r}var r=f,o=new w;a.setDisposable(o),o.setDisposable(t.subscribe(function(){e()&&c.setDisposable(n.subscribe(i)),o.dispose()},function(t){e()&&i.onError(t)},function(){e()&&c.setDisposable(n.subscribe(i))}))}function u(){var t=!h;return t&&f++,t}var c=new g,a=new g,l=new w;c.setDisposable(l);var f=0,h=!1;return s(t),l.setDisposable(o.subscribe(function(t){if(u()){i.onNext(t);var n;try{n=e(t)}catch(o){return i.onError(o),r}s(S(n)?_(n):n)}},function(t){u()&&i.onError(t)},function(){u()&&i.onCompleted()})),new E(c,a)})},h.throttleWithSelector=function(t){var e=this;return new p(function(n){var o,i=!1,s=new g,u=0,c=e.subscribe(function(e){var c;try{c=t(e)}catch(a){return n.onError(a),r}S(c)&&(c=_(c)),i=!0,o=e,u++;var l=u,f=new w;s.setDisposable(f),f.setDisposable(c.subscribe(function(){i&&u===l&&n.onNext(o),i=!1,f.dispose()},n.onError.bind(n),function(){i&&u===l&&n.onNext(o),i=!1,f.dispose()}))},function(t){s.dispose(),n.onError(t),i=!1,u++},function(){s.dispose(),i&&n.onNext(o),n.onCompleted(),i=!1,u++});return new E(c,s)})},h.skipLastWithTime=function(t,e){O(e)||(e=y);var n=this;return new p(function(r){var o=[];return n.subscribe(function(n){var i=e.now();for(o.push({interval:i,value:n});o.length>0&&i-o[0].interval>=t;)r.onNext(o.shift().value)},r.onError.bind(r),function(){for(var n=e.now();o.length>0&&n-o[0].interval>=t;)r.onNext(o.shift().value);r.onCompleted()})})},h.takeLastWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){var o=[];return n.subscribe(function(n){var r=e.now();for(o.push({interval:r,value:n});o.length>0&&r-o[0].interval>=t;)o.shift()},r.onError.bind(r),function(){for(var n=e.now();o.length>0;){var i=o.shift();t>=n-i.interval&&r.onNext(i.value)}r.onCompleted()})})},h.takeLastBufferWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){var o=[];return n.subscribe(function(n){var r=e.now();for(o.push({interval:r,value:n});o.length>0&&r-o[0].interval>=t;)o.shift()},r.onError.bind(r),function(){for(var n=e.now(),i=[];o.length>0;){var s=o.shift();t>=n-s.interval&&i.push(s.value)}r.onNext(i),r.onCompleted()})})},h.takeWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){return new E(e.scheduleWithRelative(t,r.onCompleted.bind(r)),n.subscribe(r))})},h.skipWithTime=function(t,e){var n=this;return O(e)||(e=y),new p(function(r){var o=!1;return new E(e.scheduleWithRelative(t,function(){o=!0}),n.subscribe(function(t){o&&r.onNext(t)},r.onError.bind(r),r.onCompleted.bind(r)))})},h.skipUntilWithTime=function(t,e){O(e)||(e=y);var n=this,r=t instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new p(function(o){var i=!1;return new E(e[r](t,function(){i=!0}),n.subscribe(function(t){i&&o.onNext(t)},o.onError.bind(o),o.onCompleted.bind(o)))})},h.takeUntilWithTime=function(t,e){O(e)||(e=y);var n=this,r=t instanceof Date?"scheduleWithAbsolute":"scheduleWithRelative";return new p(function(o){return new E(e[r](t,o.onCompleted.bind(o)),n.subscribe(o))})},n});