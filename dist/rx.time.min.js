/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){var b={"function":!0,object:!0},c=b[typeof exports]&&exports&&!exports.nodeType&&exports,d=b[typeof self]&&self.Object&&self,e=b[typeof window]&&window&&window.Object&&window,f=b[typeof module]&&module&&!module.nodeType&&module,g=(f&&f.exports===c&&c,c&&f&&"object"==typeof global&&global&&global.Object&&global),h=h=g||e!==(this&&this.window)&&e||d||this;"function"==typeof define&&define.amd?define(["./rx"],function(b,c){return a(h,c,b)}):"object"==typeof module&&module&&module.exports===c?module.exports=a(h,module.exports,require("./rx")):h.Rx=a(h,{},h.Rx)}).call(this,function(a,b,c,d){function e(a){return function(){try{return a.apply(this,arguments)}catch(b){return L.e=b,L}}}function f(a,b){return new t(function(c){return b.scheduleFuture(null,a,function(){c.onNext(0),c.onCompleted()})})}function g(a,b,c){return new t(function(d){var e=a,f=F(b);return c.scheduleRecursiveFuture(0,e,function(a,b){if(f>0){var g=c.now();e+=f,g>=e&&(e=g+f)}d.onNext(a),b(a+1,new Date(e))})})}function h(a,b,c){return a===b?new t(function(a){return c.schedulePeriodic(0,b,function(b){return a.onNext(b),b+1})}):u(function(){return g(new Date(c.now()+a),b,c)})}function i(a,b,c){return new t(function(d){var e,f=!1,g=new z,h=null,i=[],j=!1;return e=a.materialize().timestamp(c).subscribe(function(a){var e,k;"E"===a.value.kind?(i=[],i.push(a),h=a.value.exception,k=!j):(i.push({value:a.value,timestamp:a.timestamp+b}),k=!f,f=!0),k&&(null!==h?d.onError(h):(e=new y,g.setDisposable(e),e.setDisposable(c.scheduleRecursiveFuture(null,b,function(a,b){var e,g,k,l;if(null===h){j=!0;do k=null,i.length>0&&i[0].timestamp-c.now()<=0&&(k=i.shift().value),null!==k&&k.accept(d);while(null!==k);l=!1,g=0,i.length>0?(l=!0,g=Math.max(0,i[0].timestamp-c.now())):f=!1,e=h,j=!1,null!==e?d.onError(e):l&&b(null,g)}}))))}),new B(e,g)},a)}function j(a,b,c){return u(function(){return i(a,b-c.now(),c)})}function k(a,b,c){var d,e;return I(b)?e=b:(d=b,e=c),new t(function(b){function c(){i.setDisposable(a.subscribe(function(a){var c=M(e)(a);if(c===L)return b.onError(c.e);var d=new y;g.add(d),d.setDisposable(c.subscribe(function(){b.onNext(a),g.remove(d),f()},function(a){b.onError(a)},function(){b.onNext(a),g.remove(d),f()}))},function(a){b.onError(a)},function(){h=!0,i.dispose(),f()}))}function f(){h&&0===g.length&&b.onCompleted()}var g=new A,h=!1,i=new z;return d?i.setDisposable(d.subscribe(c,function(a){b.onError(a)},c)):c(),new B(i,g)},this)}function l(a,b,c){return J(c)||(c=x),new t(function(d){var e,f=new z,g=!1,h=0,i=a.subscribe(function(a){g=!0,e=a,h++;var i=h,j=new y;f.setDisposable(j),j.setDisposable(c.scheduleFuture(null,b,function(){g&&h===i&&d.onNext(e),g=!1}))},function(a){f.dispose(),d.onError(a),g=!1,h++},function(){f.dispose(),g&&d.onNext(e),d.onCompleted(),g=!1,h++});return new B(i,f)},this)}function m(a,b){return new t(function(c){var d,e=!1,f=new z,g=0,h=a.subscribe(function(a){var h=M(b)(a);if(h===L)return c.onError(h.e);H(h)&&(h=K(h)),e=!0,d=a,g++;var i=g,j=new y;f.setDisposable(j),j.setDisposable(h.subscribe(function(){e&&g===i&&c.onNext(d),e=!1,j.dispose()},function(a){c.onError(a)},function(){e&&g===i&&c.onNext(d),e=!1,j.dispose()}))},function(a){f.dispose(),c.onError(a),e=!1,g++},function(){f.dispose(),e&&c.onNext(d),c.onCompleted(),e=!1,g++});return new B(h,f)},a)}function n(a){return a.toArray()}function n(a){return a.toArray()}function o(a,b){return new t(function(c){function d(){g&&(g=!1,c.onNext(e)),f&&c.onCompleted()}var e,f=!1,g=!1,h=new y;return h.setDisposable(a.subscribe(function(a){g=!0,e=a},function(a){c.onError(a)},function(){f=!0,h.dispose()})),new B(h,b.subscribe(d,function(a){c.onError(a)},d))},a)}function p(a,b,c,d){return I(b)&&(d=c,c=b,b=v()),d||(d=w(new O)),new t(function(e){function f(a){var b=k,c=new y;i.setDisposable(c),c.setDisposable(a.subscribe(function(){k===b&&h.setDisposable(d.subscribe(e)),c.dispose()},function(a){k===b&&e.onError(a)},function(){k===b&&h.setDisposable(d.subscribe(e))}))}function g(){var a=!l;return a&&k++,a}var h=new z,i=new z,j=new y;h.setDisposable(j);var k=0,l=!1;return f(b),j.setDisposable(a.subscribe(function(a){if(g()){e.onNext(a);var b=M(c)(a);if(b===L)return e.onError(b.e);f(H(b)?K(b):b)}},function(a){g()&&e.onError(a)},function(){g()&&e.onCompleted()})),new B(h,i)},a)}function q(a,b,c,d){return J(c)&&(d=c,c=w(new O)),c instanceof Error&&(c=w(c)),J(d)||(d=x),new t(function(e){function f(){var a=g;k.setDisposable(d.scheduleFuture(null,b,function(){g===a&&(H(c)&&(c=K(c)),i.setDisposable(c.subscribe(e)))}))}var g=0,h=new y,i=new z,j=!1,k=new z;return i.setDisposable(h),f(),h.setDisposable(a.subscribe(function(a){j||(g++,e.onNext(a),f())},function(a){j||(g++,e.onError(a))},function(){j||(g++,e.onCompleted())})),new B(i,k)},a)}var r=c.Observable,s=r.prototype,t=c.AnonymousObservable,u=r.defer,v=(r.empty,r.never),w=r["throw"],x=(r.fromArray,c.Scheduler["default"]),y=c.SingleAssignmentDisposable,z=c.SerialDisposable,A=c.CompositeDisposable,B=c.BinaryDisposable,C=c.RefCountDisposable,D=c.Subject,E=c.internals.addRef,F=c.Scheduler.normalize,G=c.helpers,H=G.isPromise,I=G.isFunction,J=c.Scheduler.isScheduler,K=r.fromPromise,L={e:{}},M=c.internals.tryCatch=function(a){if(!I(a))throw new TypeError("fn must be a function");return e(a)},N=r.interval=function(a,b){return h(a,a,J(b)?b:x)};r.timer=function(a,b,c){var e;return J(c)||(c=x),null!=b&&"number"==typeof b?e=b:J(b)&&(c=b),(a instanceof Date||"number"==typeof a)&&e===d?f(a,c):a instanceof Date&&e!==d?g(a.getTime(),b,c):h(a,e,c)};s.delay=function(){var a=arguments[0];if("number"==typeof a||a instanceof Date){var b=a,c=arguments[1];return J(c)||(c=x),b instanceof Date?j(this,b,c):i(this,b,c)}if(r.isObservable(a)||I(a))return k(this,a,arguments[1]);throw new Error("Invalid arguments")},s.debounce=function(){if(I(arguments[0]))return m(this,arguments[0]);if("number"==typeof arguments[0])return l(this,arguments[0],arguments[1]);throw new Error("Invalid arguments")},s.windowWithTime=function(a,b,c){var d,e=this;return null==b&&(d=a),J(c)||(c=x),"number"==typeof b?d=b:J(b)&&(d=a,c=b),new t(function(b){function f(){var a=new y,e=!1,g=!1;l.setDisposable(a),j===i?(e=!0,g=!0):i>j?e=!0:g=!0;var n=e?j:i,o=n-m;m=n,e&&(j+=d),g&&(i+=d),a.setDisposable(c.scheduleFuture(null,o,function(){if(g){var a=new D;k.push(a),b.onNext(E(a,h))}e&&k.shift().onCompleted(),f()}))}var g,h,i=d,j=a,k=[],l=new z,m=0;return g=new A(l),h=new C(g),k.push(new D),b.onNext(E(k[0],h)),f(),g.add(e.subscribe(function(a){for(var b=0,c=k.length;c>b;b++)k[b].onNext(a)},function(a){for(var c=0,d=k.length;d>c;c++)k[c].onError(a);b.onError(a)},function(){for(var a=0,c=k.length;c>a;a++)k[a].onCompleted();b.onCompleted()})),h},e)},s.windowWithTimeOrCount=function(a,b,c){var d=this;return J(c)||(c=x),new t(function(e){function f(b){var d=new y;g.setDisposable(d),d.setDisposable(c.scheduleFuture(null,a,function(){if(b===k){j=0;var a=++k;l.onCompleted(),l=new D,e.onNext(E(l,i)),f(a)}}))}var g=new z,h=new A(g),i=new C(h),j=0,k=0,l=new D;return e.onNext(E(l,i)),f(0),h.add(d.subscribe(function(a){var c=0,d=!1;l.onNext(a),++j===b&&(d=!0,j=0,c=++k,l.onCompleted(),l=new D,e.onNext(E(l,i))),d&&f(c)},function(a){l.onError(a),e.onError(a)},function(){l.onCompleted(),e.onCompleted()})),i},d)},s.bufferWithTime=function(a,b,c){return this.windowWithTime(a,b,c).flatMap(n)},s.bufferWithTimeOrCount=function(a,b,c){return this.windowWithTimeOrCount(a,b,c).flatMap(n)},s.timeInterval=function(a){var b=this;return J(a)||(a=x),u(function(){var c=a.now();return b.map(function(b){var d=a.now(),e=d-c;return c=d,{value:b,interval:e}})})},s.timestamp=function(a){return J(a)||(a=x),this.map(function(b){return{value:b,timestamp:a.now()}})},s.sample=s.throttleLatest=function(a,b){return J(b)||(b=x),"number"==typeof a?o(this,N(a,b)):o(this,a)};var O=c.TimeoutError=function(a){this.message=a||"Timeout has occurred",this.name="TimeoutError",Error.call(this)};return O.prototype=Object.create(Error.prototype),s.timeout=function(){var a=arguments[0];if(a instanceof Date||"number"==typeof a)return q(this,a,arguments[1],arguments[2]);if(r.isObservable(a)||I(a))return p(this,a,arguments[1],arguments[2]);throw new Error("Invalid arguments")},r.generateWithAbsoluteTime=function(a,b,c,d,e,f){return J(f)||(f=x),new t(function(g){var h=!0,i=!1;return f.scheduleRecursiveFuture(a,new Date(f.now()),function(a,f){i&&g.onNext(a);try{if(h?h=!1:a=c(a),i=b(a))var j=d(a),k=e(a)}catch(l){return void g.onError(l)}i?f(j,k):g.onCompleted()})})},r.generateWithRelativeTime=function(a,b,c,d,e,f){return J(f)||(f=x),new t(function(g){var h=!0,i=!1;return f.scheduleRecursiveFuture(a,0,function(a,f){i&&g.onNext(a);try{if(h?h=!1:a=c(a),i=b(a))var j=d(a),k=e(a)}catch(l){return void g.onError(l)}i?f(j,k):g.onCompleted()})})},s.delaySubscription=function(a,b){var c=this;return J(b)||(b=x),new t(function(d){var e=new z;return e.setDisposable(b.scheduleFuture(null,a,function(){e.setDisposable(c.subscribe(d))})),e},this)},s.skipLastWithTime=function(a,b){J(b)||(b=x);var c=this;return new t(function(d){var e=[];return c.subscribe(function(c){var f=b.now();for(e.push({interval:f,value:c});e.length>0&&f-e[0].interval>=a;)d.onNext(e.shift().value)},function(a){d.onError(a)},function(){for(var c=b.now();e.length>0&&c-e[0].interval>=a;)d.onNext(e.shift().value);d.onCompleted()})},c)},s.takeLastWithTime=function(a,b){var c=this;return J(b)||(b=x),new t(function(d){var e=[];return c.subscribe(function(c){var d=b.now();for(e.push({interval:d,value:c});e.length>0&&d-e[0].interval>=a;)e.shift()},function(a){d.onError(a)},function(){for(var c=b.now();e.length>0;){var f=e.shift();c-f.interval<=a&&d.onNext(f.value)}d.onCompleted()})},c)},s.takeLastBufferWithTime=function(a,b){var c=this;return J(b)||(b=x),new t(function(d){var e=[];return c.subscribe(function(c){var d=b.now();for(e.push({interval:d,value:c});e.length>0&&d-e[0].interval>=a;)e.shift()},function(a){d.onError(a)},function(){for(var c=b.now(),f=[];e.length>0;){var g=e.shift();c-g.interval<=a&&f.push(g.value)}d.onNext(f),d.onCompleted()})},c)},s.takeWithTime=function(a,b){var c=this;return J(b)||(b=x),new t(function(d){return new B(b.scheduleFuture(d,a,function(a,b){b.onCompleted()}),c.subscribe(d))},c)},s.skipWithTime=function(a,b){var c=this;return J(b)||(b=x),new t(function(d){var e=!1;return new B(b.scheduleFuture(null,a,function(){e=!0}),c.subscribe(function(a){e&&d.onNext(a)},function(a){d.onError(a)},function(){d.onCompleted()}))},c)},s.skipUntilWithTime=function(a,b){J(b)||(b=x);var c=this;return new t(function(d){var e=!1;return new B(b.scheduleFuture(null,a,function(){e=!0}),c.subscribe(function(a){e&&d.onNext(a)},function(a){d.onError(a)},function(){d.onCompleted()}))},c)},s.takeUntilWithTime=function(a,b){J(b)||(b=x);var c=this;return new t(function(d){return new B(b.scheduleFuture(d,a,function(a,b){b.onCompleted()}),c.subscribe(d))},c)},s.throttle=function(a,b){J(b)||(b=x);var c=+a||0;if(0>=c)throw new RangeError("windowDuration cannot be less or equal zero.");var d=this;return new t(function(a){var e=0;return d.subscribe(function(d){var f=b.now();(0===e||f-e>=c)&&(e=f,a.onNext(d))},function(b){a.onError(b)},function(){a.onCompleted()})},d)},c});
//# sourceMappingURL=rx.time.map