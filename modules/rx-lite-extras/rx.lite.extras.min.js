/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){var b={"function":!0,object:!0},c=b[typeof exports]&&exports&&!exports.nodeType&&exports,d=b[typeof self]&&self.Object&&self,e=b[typeof window]&&window&&window.Object&&window,f=b[typeof module]&&module&&!module.nodeType&&module,g=(f&&f.exports===c&&c,c&&f&&"object"==typeof global&&global&&global.Object&&global),h=h=g||e!==(this&&this.window)&&e||d||this;"function"==typeof define&&define.amd?define(["./rx.lite"],function(b,c){return a(h,c,b)}):"object"==typeof module&&module&&module.exports===c?module.exports=a(h,module.exports,require("rx-lite")):h.Rx=a(h,{},h.Rx)}).call(this,function(a,b,c,d){function e(a){return function(){try{return a.apply(this,arguments)}catch(b){return R.e=b,R}}}function f(a){throw a}function g(a,b){this.scheduler=a,this.disposable=b,this.isDisposed=!1}function h(a,b){b.isDisposed||(b.isDisposed=!0,b.disposable.dispose())}function i(a,b){return a.amb(b)}function j(a){return a.toArray()}function k(a){return a.length>0}function l(a,b,c){for(var d=0,e=a.length;e>d;d++)if(c(a[d],b))return d;return-1}function m(a){this.comparer=a,this.set=[]}var n=c.Observable,o=n.prototype,p=n.never,q=n["throw"],r=c.AnonymousObservable,s=c.AnonymousObserver,t=c.Notification.createOnNext,u=c.Notification.createOnError,v=c.Notification.createOnCompleted,w=c.Observer,x=w.create,y=c.internals.AbstractObserver,z=c.Subject,A=c.internals,B=c.helpers,C=A.ScheduledObserver,D=c.SerialDisposable,E=c.SingleAssignmentDisposable,F=(c.CompositeDisposable,c.BinaryDisposable),G=c.RefCountDisposable,H=c.Disposable.empty,I=c.Scheduler.immediate,J=(B.defaultKeySerializer,c.internals.addRef),K=(B.identity,B.isPromise),L=B.isFunction,M=A.inherits,N=A.bindCallback,O=(B.noop,c.Scheduler.isScheduler),P=n.fromPromise,Q=c.ArgumentOutOfRangeError,R={e:{}},S=c.internals.tryCatch=function(a){if(!L(a))throw new TypeError("fn must be a function");return e(a)};g.prototype.dispose=function(){this.scheduler.schedule(this,h)};var T=function(a){function b(b){a.call(this),this._observer=b,this._state=0}M(b,a);var c=b.prototype;return c.onNext=function(a){this.checkAccess();var b=S(this._observer.onNext).call(this._observer,a);this._state=0,b===R&&f(b.e)},c.onError=function(a){this.checkAccess();var b=S(this._observer.onError).call(this._observer,a);this._state=2,b===R&&f(b.e)},c.onCompleted=function(){this.checkAccess();var a=S(this._observer.onCompleted).call(this._observer);this._state=2,a===R&&f(a.e)},c.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},b}(w),U=function(a){function b(b,c,d){a.call(this,b,c),this._cancel=d}return M(b,a),b.prototype.next=function(b){a.prototype.next.call(this,b),this.ensureActive()},b.prototype.error=function(b){a.prototype.error.call(this,b),this.ensureActive()},b.prototype.completed=function(){a.prototype.completed.call(this),this.ensureActive()},b.prototype.dispose=function(){a.prototype.dispose.call(this),this._cancel&&this._cancel.dispose(),this._cancel=null},b}(C);w.prototype.checked=function(){return new T(this)},w.notifyOn=function(a){return new U(a,this)},w.fromNotifier=function(a,b){var c=N(a,b,1);return new s(function(a){return c(t(a))},function(a){return c(u(a))},function(){return c(v())})},w.prototype.toNotifier=function(){var a=this;return function(b){return b.accept(a)}},w.prototype.asObserver=function(){var a=this;return new s(function(b){a.onNext(b)},function(b){a.onError(b)},function(){a.onCompleted()})},o.observeOn=function(a){var b=this;return new r(function(c){return b.subscribe(new U(a,c))},b)},o.subscribeOn=function(a){var b=this;return new r(function(c){var d=new E,e=new D;return e.setDisposable(d),d.setDisposable(a.schedule(b,function(a,b){e.setDisposable(new g(a,b.subscribe(c)))})),e},b)},n.generate=function(a,b,c,d,e){return O(e)||(e=currentThreadScheduler),new r(function(f){var g=!0;return e.scheduleRecursive(a,function(a,e){var h,i;try{g?g=!1:a=c(a),h=b(a),h&&(i=d(a))}catch(j){return f.onError(j)}h?(f.onNext(i),e(a)):f.onCompleted()})})},n.using=function(a,b){return new r(function(c){var d=H,e=S(a)();if(e===R)return new F(q(e.e).subscribe(c),d);e&&(d=e);var f=S(b)(e);return f===R?new F(q(f.e).subscribe(c),d):new F(f.subscribe(c),d)})},o.amb=function(a){var b=this;return new r(function(c){function d(){f||(f=g,j.dispose())}function e(){f||(f=h,i.dispose())}var f,g="L",h="R",i=new E,j=new E;K(a)&&(a=P(a));var k=x(function(a){d(),f===g&&c.onNext(a)},function(a){d(),f===g&&c.onError(a)},function(){d(),f===g&&c.onCompleted()}),l=x(function(a){e(),f===h&&c.onNext(a)},function(a){e(),f===h&&c.onError(a)},function(){e(),f===h&&c.onCompleted()});return i.setDisposable(b.subscribe(k)),j.setDisposable(a.subscribe(l)),new F(i,j)})},n.amb=function(){var a,b=p();if(Array.isArray(arguments[0]))a=arguments[0];else{var c=arguments.length;a=new Array(a);for(var d=0;c>d;d++)a[d]=arguments[d]}for(var d=0,c=a.length;c>d;d++)b=i(b,a[d]);return b},o.onErrorResumeNext=function(a){if(!a)throw new Error("Second observable is required");return V([this,a])};var V=n.onErrorResumeNext=function(){var a=[];if(Array.isArray(arguments[0]))a=arguments[0];else for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);return new r(function(b){var c=0,d=new D,e=I.scheduleRecursive(null,function(e,f){var g,h;c<a.length?(g=a[c++],K(g)&&(g=P(g)),h=new E,d.setDisposable(h),h.setDisposable(g.subscribe(b.onNext.bind(b),f,f))):b.onCompleted()});return new F(d,e)})};o.bufferWithCount=function(a,b){return"number"!=typeof b&&(b=a),this.windowWithCount(a,b).flatMap(j).filter(k)},o.windowWithCount=function(a,b){var c=this;if(+a||(a=0),Math.abs(a)===1/0&&(a=0),0>=a)throw new Q;if(null==b&&(b=a),+b||(b=0),Math.abs(b)===1/0&&(b=0),0>=b)throw new Q;return new r(function(d){function e(){var a=new z;i.push(a),d.onNext(J(a,g))}var f=new E,g=new G(f),h=0,i=[];return e(),f.setDisposable(c.subscribe(function(c){for(var d=0,f=i.length;f>d;d++)i[d].onNext(c);var g=h-a+1;g>=0&&g%b===0&&i.shift().onCompleted(),++h%b===0&&e()},function(a){for(;i.length>0;)i.shift().onError(a);d.onError(a)},function(){for(;i.length>0;)i.shift().onCompleted();d.onCompleted()})),g},c)};var W=function(a){function b(b,c){this._o=b,this._c=c,this._q=[],a.call(this)}return M(b,a),b.prototype.next=function(a){this._q.push(a),this._q.length>this._c&&this._q.shift()},b.prototype.error=function(a){this._o.onError(a)},b.prototype.completed=function(){this._o.onNext(this._q),this._o.onCompleted()},b}(y);o.takeLastBuffer=function(a){if(0>a)throw new Q;var b=this;return new r(function(c){return b.subscribe(new W(c,a))},b)};var X=function(a){function b(b,c){this._o=b,this._d=c,this._f=!1,a.call(this)}return M(b,a),b.prototype.next=function(a){this._f=!0,this._o.onNext(a)},b.prototype.error=function(a){this._o.onError(a)},b.prototype.completed=function(){!this._f&&this._o.onNext(defaultValue),this._o.onCompleted()},b}(y);return o.defaultIfEmpty=function(a){var b=this;return a===d&&(a=null),new r(function(c){return b.subscribe(new X(c,a))},b)},m.prototype.push=function(a){var b=-1===l(this.set,a,this.comparer);return b&&this.set.push(a),b},o.distinct=function(a,b){var c=this;return b||(b=defaultComparer),new r(function(d){var e=new m(b);return c.subscribe(function(b){var c=b;if(a)try{c=a(b)}catch(f){return void d.onError(f)}e.push(c)&&d.onNext(b)},function(a){d.onError(a)},function(){d.onCompleted()})},this)},o.singleInstance=function(){function a(){return d||(d=!0,b=c["finally"](function(){d=!1}).publish().refCount()),b}var b,c=this,d=!1;return new r(function(b){return a().subscribe(b)})},c});
//# sourceMappingURL=rx.lite.extras.map